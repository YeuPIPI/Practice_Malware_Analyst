# Practice_Malware_Analyst
# Lab 1-1 This lab uses the files Lab01-01.exe and Lab01-01.dll. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below

## 1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?

có

MD5: 290934c61de9176ad682ffdd65f0a669

SHA256: f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba

File name: Lab01-01.dll

MD5: bb7425b82141a1c0f7d60e5106676bb1


SHA256: 58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47

File name: Mal01-01.exe

## 2. When were these files compiled?

Mal01-01.exe : 2010-12-19 16:16:19 UTC

Lab01-01.dll : 2010-12-19 16:16:38 UTC

## 3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?

những files này không bị pack hay obfuscated

## 4. Do any imports hint at what this malware does? If so, which imports are they?

![image](https://user-images.githubusercontent.com/72372550/220406995-478130fc-8b82-4d5c-b1ca-96c204afc3b0.png)

![image](https://user-images.githubusercontent.com/72372550/220407286-20dcfcea-3210-42cf-888d-988fc3d46e1d.png)



## 5. Are there any other files or host-based indicators that you could look for on infected systems?

Lab01-01.dll strings:

000000026018   000010026018      0   sleep

000000026020   000010026020      0   hello

000000026028   000010026028      0   127.26.152.13

000000026038   000010026038      0   SADFHUHF

Lab01-01.exe strings:

000000003010   000000403010      0   kerne132.dll

000000003020   000000403020      0   kernel32.dll

00000000304C   00000040304C      0   C:\windows\system32\kerne132.dll

000000003070   000000403070      0   Kernel32.

00000000307C   00000040307C      0   Lab01-01.dll

00000000308C   00000040308C      0   C:\Windows\System32\Kernel32.dll

000000003010   000000403010      0   kerne132.dll

000000003020   000000403020      0   kernel32.dll

0000000030B0   0000004030B0      0   WARNING_THIS_WILL_DESTROY_YOUR_MACHINE

## 6. What network-based indicators could be used to find this malware on infected machines?

127.26.152.13

## 7. What would you guess is the purpose of these files?

Nó sẽ tìm kiếm và sao chép các tệp sử dụng dll kết nối tới mạng backdoor tới miền ip 127.26.152.13 . Khi đó kẻ tấn công có thể sử dụng các command như hello , sleep và exec trên hệ thống bị nhiễm như lệnh ngủ và các lệnh hệ thống

# Lab 1-2

Analyze the file Lab01-02.exe
Questions

## 1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

có

MD5	8363436878404da0ae3e46991e355b83

SHA-1	5a016facbcb77e2009a01ea5c67b39af209c3fcb

SHA-256	c876a332d7dd8da331cb8eee7ab7bf32752834d4b2b54eaa362674a2a48f64a6


## 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

DetectItEasy	PE32   Packer: UPX (3.04) [NRV,best]   Compiler: Microsoft Visual C/C++ (6.0)   Linker: Microsoft Linker (6.0) [Console32,console]

Sections
Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5	                              Chi2

UPX0	4096	           16384	      0	        0	      d41d8cd98f00b204e9800998ecf8427e	-1

UPX1	20480	           4096	        1536	    7.07	  ad0f236c2b34f1031486c8cc4803a908	5848.3

UPX2	24576	           4096	        512	      2.8	    f998d25f473e69cc89bf43af3102beea	53922

Chỉ số entropy khá cao cho thấy dấu hiệu rằng file đã bị pack ví dụ như UPX1 có chỉ số entropy là 7.07

Cách 1 : dùng tool https://upx.github.io/ 
để unpack file để có thể chạy ta dùng command sau : ./upx -d Lab01-02.exe -o Lab01-02_unpack.exe và ta sẽ được 1 file đã được unpack

Cách 2 : Tự unpack file bằng cách tìm OEP

Khi load vào IDA ta sẽ thấy ngay hàm pushad
![image](https://user-images.githubusercontent.com/72372550/220503828-400c0392-4600-4ad9-8e3c-56559eb87e99.png)
Đầu tiên nó sẽ lưu hết giá trị của các thanh ghi bằng lệnh pusha

Tiếp theo nó sẽ unpack hết các seations trong bộ nhớ

Nó sẽ fix lại IAT

Dùng lênh popad để khôi phục lại trạng thái của các thanh ghi

Và cuối cùng nhảy đến OEP để thực thi file như ban đầu
![image](https://user-images.githubusercontent.com/72372550/220504505-33afbe2d-111f-4d77-a5aa-c8a1c93b04c5.png)

Nhìn hình chúng ta có thể thấy lệnh popad và lệnh jmp near ptr dword_401190 vậy nên OEP chính là offset 0x401190

Chúng ta đã tìm được OEP h chúng ta sẽ fix lại IAT bằng tool Scylla . Đặt breakpoint tại điểm này để nhảy tới OEP

![image](https://user-images.githubusercontent.com/72372550/220506085-9733e7c2-53e8-4b2e-985d-2bce68902e53.png)

Đây là entrypoint của file gốc và khi đó chúng ta dùng Scylla để fix lại IAT

![image](https://user-images.githubusercontent.com/72372550/220506189-19377b1e-729c-451b-9bfc-09e8a2c7f662.png)

![image](https://user-images.githubusercontent.com/72372550/220506404-5ddfa7fd-ccc2-4bfe-9a5e-7a19f1ea6ce6.png)

Sau khi fix xong và dump bộ nhớ ra chúng ta cũng sẽ được 1 file đã unpack 

![image](https://user-images.githubusercontent.com/72372550/220506597-ff887cee-9399-45c7-bcb7-08f2dec4cd31.png)

## 3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

![image](https://user-images.githubusercontent.com/72372550/220519650-e707044b-5f33-46bd-9746-07efb5fb3f8e.png)
KERNEL32.DLL

SystemTimeToFileTime

GetModuleFileNameA

CreateMutexA

CreateThread

SetWaitableTimer

ADVAPI32.DLL

CreateServiceA

StartServiceCtrlDispatcherA

OpenSCManagerA

WININET.DLL

InternetOpenUrlA

InternetOpenA

## 4. What host- or network-based indicators could be used to identify this malware on infected machines?

Dịch vụ Malservice được cung cấp đến miền URL http://www.malwareanalysisbook.com

# Lab 1-3 Analyze the file Lab01-03.exe. Questions

## 1. Upload the Lab01-03.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

MD5	9c5c27494c28ed0b14853b346b113145

SHA-1	290ab6f431f46547db2628c494ce615d6061ceb8

SHA-256	7983a582939924c70e3da2da80fd3352ebc90de7b8c4c427d484ff4f050f0aec


## 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Ta thấy nó đã bị pack FSG

DetectItEasy	PE32   Packer: FSG (1.0)

File size	4.64 KB (4752 bytes)

PEiD packer	FSG v1.00 (Eng) -> dulek/xt


Ta sẽ dùng tool OllyDBG để tìm OEP
![image](https://user-images.githubusercontent.com/72372550/221394751-fed07134-4183-416e-aa03-0c09e63e4fde.png)

Ta sẽ dùng chức năng trace từng bytewase( very slow) 

![image](https://user-images.githubusercontent.com/72372550/221394780-cb7d7253-282b-4614-8938-24efb704a64f.png)

Sau đó load lại file và bật chức năng stop at entry of self-extrator 

![image](https://user-images.githubusercontent.com/72372550/221394826-db47968f-0776-4737-9d06-8eea2fdf1b93.png)

Khi đó nó sẽ nhảy đến địa chỉ 0x00401090 như hình dưới vậy OEP chính là offset 0x004001090

![image](https://user-images.githubusercontent.com/72372550/221394883-9127596f-05d6-4b2d-bf27-6bab90093f78.png)

Sau khi tìm được OEP ta sẽ tiến hành dump file và fix lại IAT . Ta sẽ đặt breakpoint tại điểm nhảy tới OEP 

![image](https://user-images.githubusercontent.com/72372550/221394950-36153975-8cbe-493b-a3e7-64c17e59818a.png)

![image](https://user-images.githubusercontent.com/72372550/221395031-79854007-75ed-4cde-b9d8-33b380ded191.png)

![image](https://user-images.githubusercontent.com/72372550/221395130-20fa80f6-3852-49f9-8e20-36ee7be98546.png)

Ta sẽ được 1 file đã unpack . Ta thấy sau khi unpack delect it easy đã nhận được được trình biên dịch 

![image](https://user-images.githubusercontent.com/72372550/221395182-433ca1db-d78d-45fe-b4e0-5c99d8ee720d.png)

## 3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

![image](https://user-images.githubusercontent.com/72372550/221395456-a4179ae0-ad2a-4151-9f3c-e7cfb3b71e5e.png)

![image](https://user-images.githubusercontent.com/72372550/221395500-4af0de23-ad1b-49af-9aa0-b7b816197d80.png)

Chúng ta có thể thấy nó có dll OLEAUT32.DLL dùng băm header

## 4. What host- or network-based indicators could be used to identify this malware on infected machines?

http://www.malwareanalysisbook.com/ad.html

ở trong string hiển thị 1 miền URL có khả năng nó kết nối tới miền dịch vụ này

# Lab 1-4 Analyze the file Lab01-04.exe. Questions

## 1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

59 security vendors and 1 sandbox flagged this file as malicious

MD5	625ac05fd47adc3c63700c3b30de79ab

SHA-1	9369d80106dd245938996e245340a3c6f17587fe

SHA-256	0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126

## 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
DetectItEasy	PE32   Compiler: EP:Microsoft Visual C/C++ (6.0 (1720-9782)) [EXE32]   Compiler: Microsoft Visual C/C++ (6.0) [msvcrt]   Linker: Microsoft Linker (6.0*)[GUI32]

File size	36.00 KB (36864 bytes)

PEiD packer	Microsoft Visual C++

Cyren packer	rsrc
![image](https://user-images.githubusercontent.com/72372550/220807331-92b295fa-39f5-4034-8191-42e4b0a8964e.png)

## 3. When was this program compiled?

![image](https://user-images.githubusercontent.com/72372550/220807366-e4b3b773-92e7-4e3f-b18e-3907aad56097.png)

## 4. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
![image](https://user-images.githubusercontent.com/72372550/220807609-41f2cc04-cce3-423c-abb1-adc76b77ce1c.png)

## 5. What host- or network-based indicators could be used to identify this malware on infected machines?
![image](https://user-images.githubusercontent.com/72372550/220807914-b3ba7b8d-3a3c-441f-9607-151ad3f3478b.png)

## 6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?
nó dùng 1 thư viện dll để dowload file
![image](https://user-images.githubusercontent.com/72372550/220809326-179826ef-5bdf-4e6f-8df2-21cd34ecad2c.png)

# Lab 3-1 Analyze the malware found in the file Lab03-01.exe using basic dynamic analysis tools.
# Questions

## 1. What are this malware’s imports and strings? 

Nó import api ExitProcess từ kernel32

![image](https://user-images.githubusercontent.com/72372550/221392012-a16f48ce-e83a-4023-be81-698da3cb5576.png)

![image](https://user-images.githubusercontent.com/72372550/221392015-c0186014-69d4-44a8-af30-667a5c7be538.png)

Có vẻ như nó sẽ kết nối đến 1 URL và thay đổi giá trị của 1 số khóa , ngoài ta còn có vmx32to64.exe là tên phần mềm độc hại

## 2. What are the malware’s host-based indicators?

WinVMX32, vmx32-to64.exe trong C:\WINDOWS\system32 , VideoDriver 

## 3. Are there any useful network-based signatures for this malware? If so, what are they

Chúng ta có thể tháy nó kết nối đến 1 miền www.practicalmalwareanalysis.com

# Lab 3-2 Analyze the malware found in the file Lab03-02.dll using basic dynamic analysis tools.

## 1. How can you get this malware to install itself?

Vì đây là 1 file dll mã độc nên chúng ta có thể sử dụng rundll32.exe để chạy . Để chạy rundll32.exe chúng ta cần biết cần biết tên dll và tên func export

![image](https://user-images.githubusercontent.com/72372550/222377901-92bac1b7-7103-46db-abc2-ca7cc6f89d74.png)

Nhìn ảnh chúng ta có thể thấy 1 hàm tên là installA

sau khi chạy rundll32.exe Lab03-02.dll installA . Chúng ta sẽ theo dõi trên regshot và so sánh thì chúng ta sẽ có giá trị sau 

----------------------------------
Keys added: 9

----------------------------------

HKLM\SYSTEM\ControlSet001\Services\IPRIP

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Parameters

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Security

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\Parameters

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\Security

HKU\S-1-5-21-2025429265-1708537768-1060284298-1003\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSaveMRU\hivu

HKU\S-1-5-21-2025429265-1708537768-1060284298-1003\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.hivu

HKU\S-1-5-21-2025429265-1708537768-1060284298-1003\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.hivu\OpenWithList

----------------------------------

Values added: 37

----------------------------------

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Type: 0x00000020

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Start: 0x00000002

HKLM\SYSTEM\ControlSet001\Services\IPRIP\ErrorControl: 0x00000001

HKLM\SYSTEM\ControlSet001\Services\IPRIP\ImagePath: "%SystemRoot%\System32\svchost.exe -k netsvcs"

HKLM\SYSTEM\ControlSet001\Services\IPRIP\DisplayName: "Intranet Network Awareness (INA+)"

HKLM\SYSTEM\ControlSet001\Services\IPRIP\ObjectName: "LocalSystem"

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Description: "Depends INA+, Collects and stores network configuration and location information, and notifies applications when 

this information changes."

HKLM\SYSTEM\ControlSet001\Services\IPRIP\DependOnService:  52 00 70 00 63 00 53 00 73 00 00 00 00 00

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Parameters\ServiceDll: "C:\Documents and Settings\Brett Lischalk\Desktop\Practical Malware Analysis 

Labs\BinaryCollection\Chapter_3L\Lab03-02.dll"

HKLM\SYSTEM\ControlSet001\Services\IPRIP\Security\Security:  01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 

00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 

05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 

00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\Type: 0x00000020

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\Start: 0x00000002

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\ErrorControl: 0x00000001

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\ImagePath: "%SystemRoot%\System32\svchost.exe -k netsvcs"

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\DisplayName: "Intranet Network Awareness (INA+)"

HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\ObjectName: "LocalSystem"

# 2. How would you get this malware to run after installation?

net start IPRIP 

Nhìn vào kết nối mạng chúng ta có thể thấy nó kết nối đến miền practicalmalwareanalysis.com

## 3. How can you find the process under which this malware is running?

Chúng ta có thể dùng process explorer để quan sát và xem nhìn thấy 1 process lab3-2.dll dưới process svchost.exe 

## 4. Which filters could you set in order to use procmon to glean information?

Chúng ta có thể sử dụng process id

## 5. What are the malware’s host-based indicators?

nó viết reg HKLM\SYSTEM\ControlSet001\Services\IPRIP\Parameters\ServiceDll: %CurrentDirectory%\Lab03-02.dll trong registry để thực hiện persistant

## 6. Are there any useful network-based signatures for this malware?

nó sẽ sử dụng method GET để kết nối tới practicalmalwareanalysis.com/serve.html

# Lab 3-3 Execute the malware found in the file Lab03-03.exe while monitoring it using basic dynamic analysis tools in a safe environment.

## 1. What do you notice when monitoring this malware with Process Explorer?

Khi chạy phần mềm và quan sát dưới process explorer chúng ta sẽ thấy có thêm 1 tiến trình svchost trước khi nó biến mất . Đó có thể là kỹ thuật process hollowing là 1 

kỹ thuật dùng tiến trình làm vỏ bọc của 1 tiến trình nguy hiểm 

## 2. Can you identify any live memory modifications?

![image](https://user-images.githubusercontent.com/72372550/221621194-2c9c0938-4122-471d-b49a-f323bd672eb2.png)

SetWindowsHookExA, practicalmalwareanalysis.log, và [CAPS LOCK] chúng ta có thể nhìn thấy các string trong tiến hình nên có khả năng đây là 1 keylogger

## 3. What are the malware’s host-based indicators?

Chúng ta có thể thấy nó sinh ra 1 file practicalmalwareanalysis.log và khi mở file thì thấy ghi lại các phím đã được nhập

Phân tích nhanh qua phân tích động thì về cơ bản nó chỉ lưu lại ký tự chứ không mở kết nối tới miền nào . Lướt qua thử phân tích tĩnh thì chúng ta thu thập các thông 

tin sau . Trong hàm main nó có 3 hàm chính 

![image](https://user-images.githubusercontent.com/72372550/221623642-7e403b48-1ab4-40ce-908b-6d534187d931.png)

Hàm đầu tiên sẽ là lấy thông tin về hệ thống 

![image](https://user-images.githubusercontent.com/72372550/221624065-0d3dbc29-ef44-4450-a25b-dc54da536d5b.png)

Hàm thứ 2 thì chúng ta có thể thấy nó dùng các api cung cấp tài nguyên 

![image](https://user-images.githubusercontent.com/72372550/221625583-d8c5223b-663d-4e7b-9712-5ff2239db72a.png)

Và hàm cuối cùng là chính sẽ có nhiệm vụ chính là ghi lại ký tự các lưu vào file 

![image](https://user-images.githubusercontent.com/72372550/221626713-c18c7fd3-349c-4eb4-8717-8f002e9e9f81.png)


## 4. What is the purpose of this program?

Đây là 1 mã độc keylogger và nó sẽ lưu hết các ký tự đã nhập vào 1 file . Phân tích động k thấy có kết nối mạng

# Lab 3-4 Analyze the malware found in the file Lab03-04.exe using basic dynamic analysis tools. (This program is analyzed further in the Chapter 9 labs.)

## 1. What happens when you run this file?

Khi chúng ta chạy file sau vài giây nó sẽ tự động xóa process chính nó

## 2. What is causing the roadblock in dynamic analysis? 

Vì ở đây giới hạn là phân tích động không phân tích tĩnh nên chúng ta k biết gì nhiều . Có thể là do có chức năng phát hiện trong sandbox , máy ảo hoặc cũng có thể nó 

chỉ chạy trong 1 số múi giò nhất định

## 3. Are there other ways to run this program?

Dùng 1 số parameter hoặc là debug nó

# Lab 5-1 

Analyze the malware found in the file Lab05-01.dll using only IDA Pro. The goal of this lab is to give you hands-on experience with IDA Pro. If you’ve already 

workedwith IDA Pro, you may choose to ignore these questions and focus on reverse-engineering the malware.

## 1. What is the address of DllMain?

Nó ở địa chỉ 0x1000D02E . Chúng ta có thể dễ dàng load vào IDA và thấy điều đó 

## 2. Use the Imports window to browse to gethostbyname. Where is the import located?

![image](https://user-images.githubusercontent.com/72372550/226518572-207a05f5-4214-417f-b704-749189c6b371.png)

## 3. How many functions call gethostbyname?

![image](https://user-images.githubusercontent.com/72372550/226518607-8db4978a-5154-44d6-a278-98134c53ebbf.png)

## 4. Focusing on the call to gethostbyname located at 0x10001757, can you figure out which DNS request will be made?

![image](https://user-images.githubusercontent.com/72372550/227081014-f899a20d-887b-488a-84b1-c7e61192220a.png)

Focus theo hàm gethostbyname ở địa chỉ kia chúng ta có thể thấy nó kết nối đến miền DNS như trong ảnh

## 5. How many local variables has IDA Pro recognized for the subroutine at 0x10001656?

![image](https://user-images.githubusercontent.com/72372550/227081590-692a1ed4-447b-4049-b27c-776cb9d7d2d3.png)

Dựa vào hình trên chúng ta có thể thấy nó là 23 dựa vào thanh ghi EBP

## 6. How many parameters has IDA Pro recognized for the subroutine at 0x10001656?

Tương tự câu 5 chúng ta có thể thấy nó là 1 

## 7. Use the Strings window to locate the string \cmd.exe /c in the disassembly. Where is it located?

![image](https://user-images.githubusercontent.com/72372550/227082060-4839555e-abd2-4f5f-be6b-e2a93312c406.png)

## 8. What is happening in the area of code that references \cmd.exe /c?

![image](https://user-images.githubusercontent.com/72372550/227082816-a76188a0-dac0-4c91-8201-3c4290337db8.png)

![image](https://user-images.githubusercontent.com/72372550/227083204-d4997a8b-8529-44c0-be61-ecaaf33cd360.png)

Từ những hình trên chúng ta có thể suy luận hàm này là remoteshell

## 9. In the same area, at 0x100101C8, it looks like dword_1008E5C4 is a global variable that helps decide which path to take. How does the malware set dword_1008E5C4? (Hint: Use dword_1008E5C4’s cross-references.)

![image](https://user-images.githubusercontent.com/72372550/227084336-af3c482e-820a-43e5-b276-6c3f3cb696ef.png)

Nhìn hình chúng ta có thể thấy nó read biến dword_1008E5C4 tại 2 hàm và chỉ có 1 hàm là write nó . 

![image](https://user-images.githubusercontent.com/72372550/227084568-5093c176-be97-495b-b5e4-6eb4b649ecd9.png)

Đi vào hàm trên chúng ta có thể thấy nó là giá trị trả về của hàm sub_1003695 . đi tiếp vào hàm đó thì chúng ta thấy hàm này là 1 hàm check version OS . Vậy chúng ta 

có thể hiểu đơn rằng ý nghĩa nó là như sau :

if version == VER_PLATFORM_WIN32_NT:
  
  CmdExe = cmd.exe

else:
  
  CmdExe = command.exe

![image](https://user-images.githubusercontent.com/72372550/227085292-e8691eb9-6599-4547-a1dc-12a215d4ec3f.png)


## 10. A few hundred lines into the subroutine at 0x1000FF58, a series of comparisons use memcmp to compare strings. What happens if the string comparison to robotwork is successful (when memcmp returns 0)?

![image](https://user-images.githubusercontent.com/72372550/227086309-f9a15024-93cb-44bd-82d7-ff0f1f965118.png)

Nếu so sánh thành công thì nó sẽ đi vào hàm sub_10052A2

![image](https://user-images.githubusercontent.com/72372550/227086884-d759cd04-27b8-4f65-ba39-f63927b35f40.png)

![image](https://user-images.githubusercontent.com/72372550/227088165-cb3208d0-0a11-416d-9507-0dcee5af8a82.png)


Nhìn vào hình chúng ta có thể suy luận là nó sẽ đăng ký 1 key và add value là WorkTime

## 11. What does the export PSLIST do?

![image](https://user-images.githubusercontent.com/72372550/227093019-d5a2440f-6bac-48ce-aa77-fd7c20f91a64.png)


Đi vào hàm PSLIST chúng ta có thể thấy có 1 biến result được trả về từ hàm sub_100036C3 . Đi vào hàm sub_100036C3 chúng ta có thể thấy 1 hàm CheckOS tương tự như câu 9 

Đầu tiên nó so sánh version với 2 nếu đúng thì OS đang chạy là Windows NT . Tiếp theo nó so sánh giá trị ở ebp + var_84 chính là dwMajorVersion của nó . Nếu nó bằng 5

tức là máy nạn nhân đang chạy version Windows 2000, Windows XP, Windows Server 2003, or Windows Server 2003 R2 . Nếu nó không bằng 5 mà lớn hơn thì eax = 0 còn ngược 

lại thì eax = 1 

Nhìn tiếp vào hàm PSLIST chúng ta thấy nó lấy result để so sánh . CHúng ta sẽ bật graph để có thể dễ dàng quan sát hơn 

![image](https://user-images.githubusercontent.com/72372550/227093439-5d1e3777-9d39-4b6c-8c35-0c17763adbcd.png)

Chúng ta có thể thấy tùy vào OS nó sẽ gọi tới 2 hàm khác nhau là sub_1000664C và hàm sub_1000651B . Sau khi xem qua 2 hàm thì chúng ta có thể thấy nó sẽ dùng 

CreateToolhelp32Snapshot() để lấy pid và tên process của tiến trình trong máy sau đó nó sẽ send thông tin đó qua 1 socket . Nó ghi lại các thông tin nó lấy được vào 

xinstall.dll

![image](https://user-images.githubusercontent.com/72372550/227094207-28d040c2-c32b-4b7c-9f5e-507023a2b2e6.png)

![image](https://user-images.githubusercontent.com/72372550/227094297-2a84c150-8db1-43b9-986c-3df1b3257c98.png)

Nhìn hình chúng ta có thể thấy nó openprocess và EnumProcessModules đều là bật và xem process đang load các dll , tiến trình con nào . Sau khi duyệt qua hết xong thì 

nó sẽ closehandle

## 12. Use the graph mode to graph the cross-references from sub_10004E79. Which API functions could be called by entering this function? Based on the API functions alone, what could you rename this function?

Khi mở hàm sub_10004E79

![image](https://user-images.githubusercontent.com/72372550/227094888-a1d0b45f-4ac7-48fd-87ce-e5c4273b563d.png)

nhìn vào hình chúng ta thấy nó gọi hàm GetSystemDefaultLangID() . Chúng ta có thể suy đoán hàm này là lấy mã ngôn ngữ của hệ thống mặc định . Hàm trả về một giá trị 

kiểu LANGID, được sử dụng để đại diện cho mã ngôn ngữ, ví dụ: tiếng Anh là 0x0409, tiếng Nhật là 0x0411. Hàm này có thể được sử dụng để xác định ngôn ngữ hiển thị trên 

hệ thống, hoặc để thực hiện các hoạt động phụ thuộc vào ngôn ngữ của hệ thống. Vậy chúng ta có thể đổi tên hàm là Get_Language_ID 

## 13. How many Windows API functions does DllMain call directly? How many at a depth of 2?

![image](https://user-images.githubusercontent.com/72372550/227097469-4b6d56b4-fb4c-4394-bf43-9f4357aecb8f.png)

Và khi depth là 2 

![image](https://user-images.githubusercontent.com/72372550/227097582-b8a887ed-3003-4a14-b68c-52fe9fabe660.png)


## 14. At 0x10001358, there is a call to Sleep (an API function that takes one parameter containing the number of milliseconds to sleep). Looking backward through the code, how long will the program sleep if this code executes?

![image](https://user-images.githubusercontent.com/72372550/227097734-8687e83e-bff4-4921-ab35-b26af027896d.png)

Nhìn vào hình chúng ta có thể thấy trước hàm sleep nó gọi hàm atoi có giá trị là atoi(off_10019020[0] + 13) và khi đi vào hàm đó ở vị trí 13 chúng ta có thể thấy giá 

giá trị là 30 . Vậy hàm sleep sẽ là 30 * 1000 = 30000ms là 30s

## 15. At 0x10001701 is a call to socket. What are the three parameters?

![image](https://user-images.githubusercontent.com/72372550/227098248-05b5bc5e-f896-41c9-893e-7395ff063ded.png)

Chúng ta có thể thấy nó lần lượt push 6 , 1 , 2 vào

## 16. Using the MSDN page for socket and the named symbolic constants functionality in IDA Pro, can you make the parameters more meaningful?What are the parameters after you apply changes?

AF_INET = 2 (IPv4)

SOCK_STREAM = 1 (TCP)

IPPROTO_TCP = 6 (TCP)

## 17. Search for usage of the in instruction (opcode 0xED). This instruction is used with a magic string VMXh to perform VMware detection. Is that in use in this malware? Using the cross-references to the function that executes the in instruction, is there further evidence of VMware detection?

![image](https://user-images.githubusercontent.com/72372550/227099387-4ac82fdc-583e-497c-9daf-726d0aa738d4.png)

![image](https://user-images.githubusercontent.com/72372550/227099696-8f2d8fc1-9d2a-4f91-985b-09785e336f4d.png)

Có vẻ như chương trình này có khả năng phát hiện VMware . Khi bật danh sách các hàm gọi đến hàm này và mở thử 1 hàm thì chúng ta thấy điều này 

![image](https://user-images.githubusercontent.com/72372550/227099982-d712d756-eccb-4506-bfff-66d732bd5a69.png)

Nó sẽ phát hiện chúng ta debug nó trong máy ảo . Đây có lẽ là 1 kỹ thuật anti debug trong máy ảo 

## 18. Jump your cursor to 0x1001D988. What do you find? 

![image](https://user-images.githubusercontent.com/72372550/227100476-0bbfe21b-ac1e-45f0-bed1-c0627e79d04f.png)

## 19. If you have the IDA Python plug-in installed (included with the commercial version of IDA Pro), run Lab05-01.py, an IDA Pro Python script provided with the malware for this book. (Make sure the cursor is at 0x1001D988.) What happens after you run the script?

Mở thử file script thì chúng ta thấy nó là phép xor cơ bản

![image](https://user-images.githubusercontent.com/72372550/227103529-beeed415-5973-423a-9e1e-8634247917d4.png)

![image](https://user-images.githubusercontent.com/72372550/227103546-644abb19-7253-4acd-bdcd-0a6d70c59645.png)

Nó sẽ xor cái byte ở vị trí 0x1001D988 có size là 0x50 với giá trị là 0x55

![image](https://user-images.githubusercontent.com/72372550/227103932-0e343864-ef60-45a2-bbe0-1da65b3637ba.png)


## 20. With the cursor in the same location, how do you turn this data into a single ASCII string?

Nhấn A

## 21. Open the script with a text editor. How does it work?

Như nói câu 19 là nó sẽ xor từng byte ở bắt đầu vị trí 0x1001D988 với 0x50 lần và key là 0x55

# Lab 6-1 In this lab, you will analyze the malware found in the file Lab06-01.exe.Questions

## 1. What is the major code construct found in the only subroutine called by main?

Ở trong hàm main có 1 hàm là check_internet_state sẽ gọi 1 api để xem có kết nối mạng không .

![image](https://user-images.githubusercontent.com/72372550/227124230-30e5299d-4ad3-475a-aec3-11f970755feb.png)

## 2. What is the subroutine located at 0x40105F?

Đó là hàm printf 

## 3. What is the purpose of this program? 

Nó chỉ đơn giản là chương trình check xem có kết nối mạng hay không thôi

# Lab 6-2.Analyze the malware found in the file Lab06-02.exe.Questions

## 1. What operation does the first subroutine called by main perform?

Sau khi load vào IDA ta sẽ thấy như hình . Đầu tiên nó sẽ có hàm check xem có kết nối đến internet hay k giống với lab 6.1

![image](https://user-images.githubusercontent.com/72372550/227125634-08c1c57d-8710-49ac-a986-305fb064437f.png)


## 2. What is the subroutine located at 0x40117F?

Hàm này cũng giống lab 6.1 là hàm printf

## 3. What does the second subroutine called by main do?

Ở hàm thứ 2 nó sẽ lấy 1 biến v4 là kết quả trả về của hàm sub_401040 . Đi sâu vào hàm đấy ta sẽ được thế này 

![image](https://user-images.githubusercontent.com/72372550/227126053-f241e38c-2195-4528-b7b0-ea9a2a7fd3c1.png)

Đầu tiên nó sẽ mở trình duyệt explorer sử dụng api InternetOpenA . Sau đó nó sẽ dùng api InternetOpenUrlA để connect tới miền url này 

http://www.practicalmalwareanalysis.com/cc.htm . Sau đó nó sẽ đọc nội dung trang web trả về bằng api InternetReadFile . Sau đó, chương trình kiểm tra xem các ký tự đầu 

tiên của nội dung đọc được có phải là dấu "! - - <" không. Nếu đúng, chương trình sẽ trả về giá trị của ký tự thứ 5 trong chuỗi. Nếu không, chương trình sẽ in ra thông 

báo lỗi và trả về giá trị 0.

Tóm lại, đoạn mã này có chức năng gửi yêu cầu tới server để lấy lệnh điều khiển và xử lý phản hồi trả về từ server.

## 4. What type of code construct is used in this subroutine?

Chắc là if / else

## 5. Are there any network-based indicators for this program?

Internet Explorer 7.5/pma ,  URL: http://www.practicalmalwareanalysis.com/cc.htm

## 6. What is the purpose of this malware?

có khả năng là botnet hoặc là backdoor , Đầu tiên nó sẽ check internet có kết nối thành công hay không . Sau đó nó sẽ connect dùng http bằng user agent với url như 

trên . Nó sẽ nhận phản hồi lại từ sever . Cuối cùng là nó sẽ sleep 60s

# Lab 6-3 In this lab, we’ll analyze the malware found in the file Lab06-03.exe.Questions

## 1. Compare the calls in main to Lab 6-2’s main method. What is the new function called from main?

![image](https://user-images.githubusercontent.com/72372550/227127825-e03d66ae-79ed-42c8-aa9b-2fda8760f6b2.png)

Khi load vào IDA . Ta sẽ dễ dàng thấy là so với lab6.2 nó có thêm hàm set_register_for_malware

## 2. What parameters does this new function take?

Hàm này nó sẽ nhận 2 tham số đầu vào . Thứ nhất là giá trị trả về từ server ở hàm đã phân tích bên trên . Thứ 2 là giá trị truyền vào của command

## 3. What major code construct does this function contain?

hàm này đã sử dụng cấu trúc switch case

![image](https://user-images.githubusercontent.com/72372550/227128412-78cc30ec-c27e-40cd-a9fa-f31237157468.png)

## 4. What can this function do?

Như đã phân tích bên trên hàm này sẽ nhận đầu vào là phản hồi từ sever . nếu là 'a' thì nó sẽ tạo 1 ổ dẫn như hình

![image](https://user-images.githubusercontent.com/72372550/227128837-66b6c7a7-cd64-478d-9787-b2f50c497fa9.png)

Nếu result là 'd' thì nó sẽ cop file thành 1 file là cc.exe

![image](https://user-images.githubusercontent.com/72372550/227129038-0551278c-7e36-4036-b0f9-c0b38c9188dc.png)

nếu là 'c' thì nó sẽ delete file đó 

nếu là d thì nó sẽ dùng api để open 1 cái key như hình để persistant 

![image](https://user-images.githubusercontent.com/72372550/227129368-95d04c3a-e778-4223-bfb3-861ca41cf4c0.png)


## 5. Are there any host-based indicators for this malware?

![image](https://user-images.githubusercontent.com/72372550/227129431-331498a5-9c59-4146-b683-38bb5ff721d8.png)

## 6. What is the purpose of this malware? 

Nó có rất nhiều chức năng tùy thuộc vào yêu cầu remote chẳng hạn như tạo file , updatefile , xóa file , đăng ký Key Run để persistant nữa . 

# Lab 6-4In this lab, we’ll analyze the malware found in the file Lab06-04.exe.Questions

## 1. What is the difference between the calls made from the main method in Labs 6-3 and 6-4?

![image](https://user-images.githubusercontent.com/72372550/227130073-03e82e25-01e5-42db-b8c3-70df16301f78.png)

Nhìn vào hình chúng ta có thể dễ dàng thấy được sự khác biệt so với lab 6-3 là ở lab 6-3 nó chỉ thực hiện có duy nhất 1 lần còn ở lab 6-4 thì nó đã dùng 1 vòng for để

có thể thực hiện nhiều lần cụ thể là 1440 lần lặp

## 2. What new code construct has been added to main?

Là cấu trúc vòng for

## 3. What is the difference between this lab’s parse HTML function and those of the previous labs?

Nó gửi user agent là pma%d thay vì pma . Ở đây %d là time run chương trình

## 4. How long will this program run? (Assume that it is connected to the Internet.)

ta lấy 1440 * 60s = 24h là 1 ngày

## 5. Are there any new network-based indicators for this malware?

![image](https://user-images.githubusercontent.com/72372550/227130793-c7890655-fb70-45c5-bc6f-77a60d912e60.png)

## 6. What is the purpose of this malware?

Về cơ bản chức năng nó vẫn giống lab6-3 nhưng nó sẽ gửi user-agent thêm ,  thực hiện nhiều lần và trong thời gian lâu hơn cụ thể là 1 ngày và 1440 lần thao tác .

# Lab 7-1Analyze the malware found in the file Lab07-01.exe. Questions

## 1. How does this program ensure that it continues running (achieves persistence) when the computer is restarted?

Sử dụng dịch vụ malservice để persistant 

## 2. Why does this program use a mutex?

Để không phải khởi tạo dịch 2 lần

## 3. What is a good host-based signature to use for detecting this program?

Service: Malservice

Mutex: HG345

## 4. What is a good network-based signature for detecting this malware?

URL: http://www.malwareanalysisbook.com

## 5. What is the purpose of this program?

Nó sẽ đặt bộ hẹn giờ là năm 2100 . Nó sẽ mở 20 thread connect tới miền dịch vụ http://www.malwareanalysisbook.com . Có vẻ đây là 1 hành động DDOS . 

## 6. When will this program finish executing?

Vì không có break  nên chương trình sẽ không dừng

# Lab 7-2 Analyze the malware found in the file Lab07-02.exe.Questions
## 1. How does this program achieve persistence?

![image](https://user-images.githubusercontent.com/72372550/227215694-4a012599-a922-4b03-9b5b-f03db3be0828.png)

Có vẻ như chương trình này không có khả năng persistant


## 2. What is the purpose of this program?

![image](https://user-images.githubusercontent.com/72372550/227215860-d2653a00-d5c6-4737-ac57-3863b1f63089.png)

Chương trình này sẽ khởi tạo 1 đối tượng COM có vẻ như là internet Explorer để kết nối tới 1 miền dịch vụ là http://www.malwareanalysisbook.com/ad.html

Gọi hàm OLE: CoCreateInstance.

CLSID: 0020FD10-0000-0000-C000-000000000046

Tên: Internet Explorer (Phiên bản 1.0)

EXE:%ProgramFiles%\Internet Explorer\iexplore.exe

## 3. When will this program finish executing?

Sau khi mở đc dịch vụ thì nó sẽ kết thúc 

# Lab 7-3

Ở bài lab này có 2 file là lab07-03.dll và lab07-03.exe ta sẽ phân tích tĩnh qua 2 file này trước khi trả lời câu hỏi vì lab này đòi hỏi chứng ta phải chạy chương 

trình này

## lab07-03.dll

![image](https://user-images.githubusercontent.com/72372550/227831763-9a06e2cc-9ce0-4d52-9a31-1680fc108deb.png)

Khi chúng ta load file dll vào IDA chúng ta sẽ thấy được những điều này đầi tiên nó sẽ mở 1 MutexA SADFHUHF trong trường không mở được thì nó sẽ CreateMuTexA . Sau đó 

nó sẽ mở WSAStartup thuộc Winsock DLL liên quan đến connect mạng . Sau đó nó sẽ khởi tạo 1 socket và kết nối nó đến miền ip 127.26.152.13 . 

![image](https://user-images.githubusercontent.com/72372550/227832269-cacaf45d-d9ba-4667-9a40-b80e52d7f561.png)

Nếu kết nối thành công nó sẽ gửi message 'hello' và nếu không thành công nó sẽ sleep 60s và gửi lại . Ngoài ra chúng ta có thể thấy nó các lệnh như exec thông qua 

CreateProcessA , hay là nó so sánh q ( quit) thì nó closehandle . Qua quan sát chúng ta có thể thấy nó hoạt động như 1 backdoor sử dụng reverse shell để nhận lệnh thực 

thi từ xa

## lab07-03.exe

![image](https://user-images.githubusercontent.com/72372550/227833355-9a14e8b3-7828-4a42-b39c-3b3727157d22.png)

Nó có 1 string cảnh báo WARNING_THIS_WILL_DESTROY_THE_MACHINE và 1 string liên quan đến 1 dll là Kernel32.dll và 1 đường dẫn đến dll đấy là C:\windows\system32\kerne132.dll 

![image](https://user-images.githubusercontent.com/72372550/227833730-f03b9657-4659-4143-b4c2-37331e94f128.png)

Chúng ta có thẻ thấy nó import những hàm này . Có vẻ như nó sẽ làm gì đó liên quan đến bộ nhớ .

![image](https://user-images.githubusercontent.com/72372550/227834505-e462f3bf-6d94-4a12-9eb1-2a1221b90f36.png)

![image](https://user-images.githubusercontent.com/72372550/227839980-f1a7599b-b73d-4636-a3c4-b3c326076ac5.png)

khi kéo xuống dưới chúng ta thấy nó dùng CopyFileA từ file dll của nó tới C:\windows\system32\kerne132.dll . Sau đó nó push đường dẫn ổ C và gọi tới hàm sub_4011E0

![image](https://user-images.githubusercontent.com/72372550/227840161-bdc8774c-5e2b-4894-b7f1-ab79db86e3ac.png)

đi tiếp vào hàm sub_4011E0

![image](https://user-images.githubusercontent.com/72372550/227840355-112dadce-2473-43c0-b203-dcacd423a7c0.png)

khi nhìn qua có vẻ nhưng hàm này nó sẽ sử dụng đệ quy vì chính nó gọi đến nó . Nó sẽ tìm kiếm các file exe và trong trường hợp nếu nó không tìm thấy nó sẽ đi vào hàm sub_4010A0

Đi vào hàm sub_4010A0

![image](https://user-images.githubusercontent.com/72372550/227840558-19ba1139-c568-4c67-bbf1-be0225f6b083.png)

Chúng ta sẽ thấy các hàm như  CreateFile, CreateFileMapping, and MapViewOfFile . 

Nó sẽ so sánh kernel32 với 1 vị trí trong tệp thực thi . Khi tìm thấy nó sẽ copy giá trị tại địa chỉ đó vào 

![image](https://user-images.githubusercontent.com/72372550/227841136-5fd79e82-618d-4a47-b607-129f67aa778e.png)

Tóm lại , nó sẽ tìm kiếm toàn bộ file trong ổ C , khi tìm thấy nó sẽ mở và trực tiếp thay đổi tệp trong bộ nhớ từ kernel32.dll thành kerne32.dll(chính là lab07-03.dll) để duy trì persistant . Như chúng ta đã phân tích file dll bên trên thì là reverse shell


## 1. How does this program achieve persistence to ensure that it continues running when the computer is restarted?

Sau khi phân tích qua thì chúng ta có thể thấy nó persistant bằng cách nó sẽ thay đổi giá trị trong bộ nhớ của kernel32.dll thành dll mã độc của nó để persistant

## 2. What are two good host-based signatures for this malware?

Mutex ‘SADFHUHF’

## 3. What is the purpose of this program?

Nó có khả năng lây nhiễm các tệp trong hệ thống ở ổ C . Nó có khả năng can thiệp sử dụng lệnh exec là lệnh hệ thống . Nó sẽ nhận từ địa chỉ ip 127.26.152.13

## 4. How could you remove this malware once it is installed?

Rất khó để xóa nó . Có vẻ viết 1 script để revese nó . Đơn giản là cài lại máy tính :))  

![image](https://user-images.githubusercontent.com/72372550/227843146-212a9eaf-f024-4309-8b37-a352c38a5fed.png)

Sau khi chạy file nó có thể dùng process monitor để quan sát . 

![image](https://user-images.githubusercontent.com/72372550/227843292-a9a52df1-153b-4c02-b3c8-6f3952fc9f59.png)

![image](https://user-images.githubusercontent.com/72372550/227843336-c0946eb8-4bc8-429d-858c-1d3804c57151.png)

Chúng ta có thể file dll độc của nó trên hệ thống trong ổ dẫn

# Lab 9-1 

## 1. How can you get this malware to install itself?

Chúng ta ném lab này vào IDApro và tìm tới hàm main . Chúng ta có thể dễ dàng quan sát thấy vài thứ sau 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/9942c2ce-8e8b-4817-8437-7f3b15157f39)

Nếu chương trình chạy chỉ với duy nhất 1 tham số nó sẽ call tới sub401000 và kiểm tra . Ở hàm sub401000 có vẻ như nó muốn tìm tới và ghi giá trị của 1 key . Nếu nó không thành công nó sẽ 

gọi tới hàm sub_402410 . Ở hàm đó chúng ta có thể thấy nó thực thi shell là xóa chương trình . 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/fe0e5007-df86-497f-b826-b4a29e23b856)

Còn nếu tham số nhiều hơn 1 thì nó sẽ kiểm tra tham số đầu vào bằng sub_402510 . Bằng khả năng reverse chúng ta có thể dễ dàng biết được nếu tham số truyền vào khác abcd thì nó sẽ thực 

hiện lại hàm sub_402410 là hàm thực hiện shell xóa chương trình . Như vậy chương trình muốn khởi chạy được thì chúng ta cần truyền vào tham số là -in abcd

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/3f489b6d-c835-4385-8141-4e697aca14d6)


## 2. What are the command-line options for this program? What is the password requirement?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/573a7955-85fc-4553-aba6-c6d74a6e9b39)

Chúng ta có thể nhìn thấy dễ dàng các optine command . password như chúng ta phân tích lúc trước sẽ là abcd

## 3. How can you use OllyDbg to permanently patch this malware, so that it doesn’t require the special command-line password?

thay vì nó chạy lệnh xor eax,eax thì chúng ta thay bằng mov eax,1 là được . Chương trình sẽ luôn trả về 1 để tiếp tục 

## 4. What are the host-based indicators of this malware?

HKLM\SOFTWARE\Microsoft \XPS

Notice the space after Microsoft!

HKLM\SYSTEM\ControlSet001\Services\Lab09-01\Security

HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\Security

Service named Lab09-01 Manager Service

C:\WINDOWS\system32\Lab09-01.exe

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/8bc79ddc-3a66-4c97-9c6c-d0ef778c8272)


## 5. What are the different actions this malware can be instructed to take via the network?

SLEEP

UPLOAD

DOWNLOAD

CMD

NOTHING

## 6. Are there any useful network-based signatures for this malware?

http://www.practicalmalwareanalysis.com

# Lab 9-2

## 1. What strings do you see statically in the binary?

Chắc là cmd

## 2. What happens when you run this binary?

Chương trình kết thúc ngay lập tức 

## 3. How can you get this sample to run its malicious payload?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/b355cbdd-84f9-4c05-9638-b8c58a6414e5)

Chúng ta có thể thấy nó dùng strcmp để compare v15 và v18 mà v15 là ocl.exe .  Vậy nếu chúng ta rename chương trình thành ocl.exe thì payload mã độc sẽ được thực thi 

## 4. What is happening at 0x00401133?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/1223d38d-a7b3-43f7-ae8c-b4eb8d915baf)


## 5. What arguments are being passed to subroutine 0x00401089?

Hàm này sẽ truyền vào 2 tham số là v14 được khởi tạo từ chuỗi "1qaz2wsx3edc" và v6 là 1 mảng 0x21 byte bắt đầu từ offset 0x405034 . Chúng ta có thể thấy hàm này mã hóa gì đó vì nó xor 2 

mảng giá trị

## 6. What domain name does this malware use?

Sau khi dùng run chương trình và đặt breakpoint chúng ta có thể xem trong memory giá trị mà xor xong là www.practicalmalwareanalysis.com

## 7. What encoding routine is being used to obfuscate the domain name?

Sử dụng phép xor

## 8. What is the significance of the CreateProcessA call at 0x0040106E?

nó khởi tạo 1 socket và kết nối tới miền DSN mà nó vừa xor xong sau đó nó tạo 1 create process có tham số truyền vào là cmd

# Lab 9-3 

## 1. What DLLs are imported by Lab09-03.exe?

DLL1

DLL2

KERNEL32

NETAPI32.dll

Khi load xem cái LoadLibraryA chúng ta sẽ các đối tượng nào gọi đến nó thì chúng ta thấy có DLL3.dll và user32.dll gọi đến nó nữa

## 2. What is the base address requested by DLL1.dll, DLL2.dll, and DLL3.dll?

0x10000000

## 3. When you use OllyDbg to debug Lab09-03.exe, what is the assigned based address for: DLL1.dll, DLL2.dll, and DLL3.dll?

0x00330000 for DLL2

0x00390000 for DLL3

0x10000000 for DLL1

## 4. When Lab09-03.exe calls an import function from DLL1.dll, what does this import function do?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/ef8240fd-1118-452b-806b-060c6584aea4)
![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/6246ce6a-dd8e-4554-a01d-891655f66375)


## 5. When Lab09-03.exe calls WriteFile, what is the filename it writes to?

file temp.txt

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/92ec187d-7265-4b1f-ae0e-5d266c377d9c)


## 6. When Lab09-03.exe creates a job using NetScheduleJobAdd, where does it get the data for the second parameter?

ở tham số thứ 2 nó sẽ truyền vào 1 buffer . Trước khi call hàm đó chúng ta thấy nó push DLL3GetStructure . Đi kỹ vào hơn dll3 chúng ta sẽ thấy buffer của NetScheduleJobAdd 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/b9e3b387-aa76-4240-ab85-50853cbc4e4a)


## 7. While running or debugging the program, you will see that it prints out three pieces of mystery data. What are the following: DLL 1 mystery data 1, DLL 2 mystery data 2, and DLL 3 mystery data 3?

DLL1 sẽ là Current process ID

DLL2 sẽ là File handle to temp.txt

DLL3 sẽ là  ping www.malwareanalysisbook.com

## 8. How can you load DLL2.dll into IDA Pro so that it matches the load address used by OllyDbg?

0x00330000 

# Lab 10-1

Trước khi trả lời từng câu hỏi chúng ta sẽ phân tích tĩnh qua 2 file là Lab10-01.exe và Lab10-01.sys

load 2 file vào IDApro chúng ta sẽ có được vài thông tin cơ bản sau 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/a1ecab4d-aeb5-4e2a-bb62-cd2a9a39dd08)

Ở file Lab10-01.exe chúng ta có thể thấy đầu tiên nó ở openSCmanager nếu thành công thì nó sẽ khởi tạo 1 service có tên là Lab10-01 và đường dẫn của nó là C:\Windows\System32\Lab10-01.sys

Nếu không thành công nó sẽ dừng còn nếu thành công thì nó sẽ bắt đầu Star và control service đó .

Đi vào file sys chúng ta có thể thấy được vài thứ sau . Ở DriverEntry nó gán giá trị UnLoad của nó trỏ tới hàm sub_10486 .

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/f11e57b6-5690-4c01-9669-e6a11b895201)

Đi tiếp vào sub_10486 chúng ta có thể thấy như sau 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/36b1c782-9c9a-4d26-8925-075f69dda63e)

Nó tạo khá nhiều key và ghi giá trị lên các key đó 

## 1. Does this program make any direct changes to the registry? (Use procmon to check.)

Chúng ta dùng tool regshot để so sánh sự thay đổi trong registry 

----------------------------------
Keys added: 6
----------------------------------
HKLM\SYSTEM\ControlSet001\Services\Lab10-01
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Security
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Enum
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Security
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Enum

----------------------------------
Values added: 20
----------------------------------
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Type: 0x00000001
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Start: 0x00000003
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\ErrorControl: 0x00000001
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\ImagePath: "\??\C:\Windows\System32\Lab10-01.sys"
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\DisplayName: "Lab10-01"
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Security\Security: 01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Enum\Count: 0x00000000
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Enum\NextInstance: 0x00000000
HKLM\SYSTEM\ControlSet001\Services\Lab10-01\Enum\INITSTARTFAILED: 0x00000001
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Type: 0x00000001
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Start: 0x00000003
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\ErrorControl: 0x00000001
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\ImagePath: "\??\C:\Windows\System32\Lab10-01.sys"
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\DisplayName: "Lab10-01"
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Security\Security: 01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Enum\Count: 0x00000000
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Enum\NextInstance: 0x00000000
HKLM\SYSTEM\CurrentControlSet\Services\Lab10-01\Enum\INITSTARTFAILED: 0x00000001
HKU\S-1-5-21-1957994488-1708537768-839522115-1003\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\{75048700-EF1F-11D0-9888-006097DEACF9}\Count\HRZR_EHACNGU:P:\Qbphzragf naq Frggvatf\oboolkc\Qrfxgbc\tb\Yno10-01.rkr: 02 00 00 00 06 00 00 00 20 EB 05 AE E5 6B CF 01
HKU\S-1-5-21-1957994488-1708537768-839522115-1003\Software\Microsoft\Windows\ShellNoRoam\MUICache\C:\Documents and Settings\bobbyxp\Desktop\go\Lab10-01.exe: "Lab10-01"

## 2. The user-space program calls the ControlService function. Can you set a breakpoint with WinDbg to see what is executed in the kernel as a result of the call to ControlService?

## 3. What does this program do?

Qua những gì đa phân tích tĩnh và quan sát khi nó chạy chúng ta có thể biết được nó là khởi tạo 1 service và service đó sẽ tạo key và thay đổi các giá trị key để tắt firewall

# Lab 10-2

## 1. Does this program create any files? If so, what are they?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/0095b0e0-d3da-4033-a9ff-95ca1f91f9aa)

Chúng ta có thể dễ dàng thấy nó dùng createFile ở path C:\WINDOWS\System32\Mlwx486.sys .

## 2. Does this program have a kernel component?

Có . Mlwx486.sys sẽ load 486 WS Driver driver.

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/457a2668-bab4-4472-b3d4-ef3e95562652)

Quan sát Delect it easy có vẻ như có 1 file ẩn pdb và chúng ta có thể thấy đường dẫn winddk và rootkit . Có vẻ như đây là rootkit 



## 3. What does this program do?



# Lab 10-3

## 1. What does this program do?

## 2. Once this program is running, how do you stop it?

## 3. What does the kernel component do?

# Lab 11-1

## 1. What does the malware drop to disk?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/d8962464-1251-4dd8-b954-756fdcd32097)

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/4b42763f-dbb1-4c57-bd39-f9197fe0244d)

Chúng ta có thể thấy nó drop 1 file trên disk là msgina32.dll

## 2. How does the malware achieve persistence?

Nó persistant bằng cách tạo thêm 1 key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL

## 3. How does the malware steal user credentials?

Nó sử dụng phương pháp GINA interception để ăn cắp mật khẩu người dùng . Nó sẽ dử dụng key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL và nó sẽ load dll độc hại của 

nó là msgina32.dll . Khi ném file dll độc hại đó vào IDA chúng ta có thể thấy như sau 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/3aaa16bd-1082-40a8-840c-19f2780ee123)


![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/fd733b6d-19e8-4066-a22f-5ac23918660e)


## 4. What does the malware do with stolen credentials?

Đi phân tích file dll độc hại đó bằng IDA chúng ta có thể thấy nó ăn cắp mật khẩu được lưu trữ ở tệp  msutil32.sys được tìm thấy trong C:\WINDOWS\system32

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/bb0e2df4-1735-4b16-ae3c-dc045fd59e9d)

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/aea734cc-e05b-414d-ae23-46dfd2966519)


## 5. How can you use this malware to get user credentials from your test environment?

Do cách khai thác mật khẩu này chỉ xảy ra trên WindowXP hoặc các bản trc 2003 nên chúng ta sử dụng win 10 sẽ k thể tìm thấy file msutil32.sys được 

# Lab 11-2

## 1. What are the exports for this DLL malware?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/cff1c15c-1e2d-493d-99c8-c7ee4928ec0c)

Chúng ta có thể nó exports duy nhất 1 cái là installer

## 2. What happens after you attempt to install this malware using rundll32.exe? 

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/8e0f4b43-7864-499e-b7ff-91bf451edefd)

khi đi vào hàm install trong dll chúng ta có thể thấy nó thực hiện hành động mở 1 key nếu k thành thì nó sẽ set giá trị trường  AppInit_DLLs thành spoolvxx32.dll . file spoolvxx32.dll 

được tạo trong C:\WINDOWS\system32 

## 3. Where must Lab11-02.ini reside in order for the malware to install properly?

NÓ phải nằm trong C:\WINDOWS\system32 

## 4. How is this malware installed for persistence?

nó cài đặt key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs . AppInit_DLLs được gọi hầu hết trong mọi process gọi  user32.dll . Vì vậy nó cũng sẽ gọi dll độc 

spoolvxx32.dll

## 5. What user-space rootkit technique does this malware employ?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/e5b24511-3859-4ee9-a555-ec639b6f0b0e)

Có vẻ như nó dùng sẽ hook trên function send của thư viện wsock32.dll và target vào  các processs THEBAT.EXE, OUTLOOK.EXE,MSIMN.EXE 

## 6. What does the hooking code do?

Có vẻ như đoạn code đó ở hàm sub_100014B6 . Đi sâu vào hàm đó

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/4a242978-d1f3-4d0c-9315-d15981899eae)

Nhìn vào đoạn code và dựa vào những chức năng đã phân tích chúng ta có thể suy đoán như sau : Đầu tiên nó sẽ target vào các process như trên đã nói sau đó nó sẽ gửi đến email nào đó với 

các command A RCPT TO SMTP

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/1d59a5f4-94fd-466c-b30f-5021de794c4d)


## 7. Which process(es) does this malware attack and why?

THEBAT.EXE, OUTLOOK.EXE, và MSIMN.EXE

## 8. What is the significance of the .ini file?

Xem dữ liệu trong file đó nó đã được mã hóa bằng cái địa chỉ email billy@malwareanalysisbook.com và nó sẽ sent cái này đi

## 9. How can you dynamically capture this malware’s activity with Wireshark?

Có thể sử dụng 1 fake server bằng INetSim để mô phỏng hoạt động gửi của mal . Dùng wireshark để phân tích như ảnh trong đáp án trước

# Lab 11-3

## 1. What interesting analysis leads can you discover using basic static analysis?

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/f8429ef8-6f34-4328-bf35-28cc93383eb2)

Nó khởi chạy 1 dịch vụ cisvc . Chúng ta có thể dễ dàng thấy các chuỗi string như C:\WINDOWS\System32\inet_epar32.dll .  C:\WINDOWS\System32\kernel64x.dll . Lab1103dll.dll

![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/9943e40b-04a4-4e20-931c-8181103cffa9)

Có vẻ như nó là 1 keylogger với các func như GetForegroundWindow , GetAsyncKeyState ,<SHIFT>

## 2. What happens when you run this malware?
  
Đầu tiên nó sẽ copy file dll từ file exe đến C:\WINDOWS\System32\inet_epar32.dll . Nó sẽ khởi tạo 1 service có tên là Content Index Service . cisvc.exe nó có tham chiếu đến  
  
 C:\WINDOWS\system32\kernel64x.dll . Khi mở file này bằng notepad chúng ta thấy nó ghi hết lại các sự kiện thao tác trên máy .

## 3. How does Lab11-03.exe persistently install Lab11-03.dll?
  
  cisvc.exe nó sẽ tải tệp dll inet_epar32.dll mà tệp đó chính là dll độc Lab11-03.dll

## 4. Which Windows system file does the malware infect?
  
  cisvc.exe

## 5. What does Lab11-03.dll do?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/aafdc9a1-9df5-4a6d-acbb-6a892d92b575)
 Đầu tiên nó khởi tạo 1 mutex sau đó nó sẽ tạo 1 file tên là kernel64x.dll . Sau khi target tới tệp đó nó sẽ gọi 1 loạt các hàm có GetForegroundWindow, GetWindowTextA, GetAsyncKeyState, 
  
và  WriteFile

## 6. Where does the malware store the data it collects

  Bên trong kernel64x.dll
# Lab 12-1
  
## 1. What happens when you run the malware executable? 
  Khi chúng ta run chương trình thì mỗi 1 phút nó sẽ hiện lên 1 message box như thế này 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/ae65ac92-bdf4-4ba0-91ce-c7fa3278d5f8)

  
## 2. What process is being injected?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/5307c289-a50e-4d00-b0bb-c18c7b0691e3)

  explorer.exe đã bị injected . Quan sát IDA chúng ta có dễ dàng phát hiện nó check các process chạy trên máy và so sánh PID nếu cái nào trùng với PID của explorer.exe thì nó sẽ inject
  
## 3. How can you make the malware stop the pop-ups?
  
  Về cơ bản chương trình này k có khả năng persistant nên chúng ta chỉ việc restart lại máy là được
  
## 4. How does this malware operate?
  
  Đầu tiên nó sử dụng psapi.dll để liệt kê tất cả quy trình . Sau đó nó lấy đường dẫn hiên tại và nối thêm với file dll Lab12-01.dll . Sau đó nó lấy số lượng process bằng enum và check 
  
  toàn bộ process xem cái nào là explorer.exe . Sau đó nó mở process và dùng các hàm như VirtualAllocEx , WriteProcessMemory , GetModuleHandleA , GetProcAddress . Về cơ bản là nó sẽ bắt 
  
  buộc explorer phải tải dll độc của nó và thực hiện hành vi của dll đó là mở cửa sổ message box mỗi 1 phút . Nếu muốn quan sát dễ hơn nữa có thể dùng x32dbg để quan sát .
  
# Lab 12-2

## 1. What is the purpose of this program?
  
  Sau khi quan sát trong strings chúng ta có thể thấy có vẻ như nó là 1 keylogger 
  
## 2. How does the launcher program hide execution?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/0ef7ac72-f4bf-4ec3-9dd2-be197b6d9978)
  
Nó được ẩn nhờ chương trình svchost.exe . Ban đầu nó create 1 process ở trạng trái theo với giá trị là 0x4 CREATE_SUSPENDED flag . 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/c16a41b0-e066-4aa7-9601-50a074eab06c)

  Sau đó nó sẽ thực thi unmapping, allocating, writing new code, setting the thread context, and resuming the svchost thread với the keylogging code.
  
## 3. Where is the malicious payload stored?
  
  LOCALIZATION
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/712bf3d4-795b-4ef3-914b-696a524c4dba)

  
  
## 4. How is the malicious payload protected?
  
  Nó dùng 1 mã hóa xor cơ bản từng byte với key là 65 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/e6bf21f9-44ea-469b-aef0-c02377ba36e2)


  
## 5. How are strings protected?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/b62be244-2111-4b81-b305-246312979102)

  
# Lab 12-3
  
## 1. What is the purpose of this malicious payload?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/947d9fbd-b8cb-4393-bbf9-35a7aa03fcda)

  nó là 1 keylogger ghi lại các hành động vào file practicalmalwareanalysis.log . 
  
## 2. How does the malicious payload inject itself?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/2579f44b-f152-4473-bfd2-2f894b036148)

  Nó là hook injection . Ở hàm setwindowhook chúng ta thấy nó push tham số 0xD . 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/c15d3e21-dc34-4b16-bf09-3a0f18d99dff)

  WH_KEYBOARD_LL cài đặt thủ tục hook giám sát các sự kiện nhập bàn phím ở mức độ low
  
## 3. What filesystem residue does this program create?
  
  Như đã nói ở trên nó là tạo 1 file log practicalmalwareanalysis.log để lưu trữ các ký tự đã nhập từ bàn phím
  
# Lab 12-4

## 1. What does the code at 0x401000 accomplish?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/47f213fa-adb1-40b9-917c-bb2115d26450)

  
  Nó truyền vào 1 giá trị PID . Nó sẽ check xem giá trị PID đấy có phải của winlogon không . Nếu đúng trả về 0 nếu sai thì về 1 . Ở hàm main nó sẽ dùng psapi.dll để lấy info về các 
  
  process đang run . Sau đó nó sẽ lặp toàn bộ cho đến khi tìm thấy winlogon
  
## 2. Which process has code injected?
  
  Dựa theo những gì câu 1 chúng ta có thể dễ dàng đoán đc process bị inject là winlogon . 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/fd53a43a-7de7-4682-8f9e-6cab320fecde)

  Ở hàm này chúng ta thấy nó truyền vào PID và sử dụng các func là Openprocess và CreateRemoteThread . Hàm sub_4010FC có nhiệm vụ thiết lập quyền đặc biệt (privilege) cho tiến trình
  
## 3. What DLL is loaded using LoadLibraryA? 
  
  sfc_os.dll sử dụng LoadLibraryA ở hàm sub_401174 . 
  
  
## 4. What is the fourth argument passed to the CreateRemoteThread call?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/9ff61a35-9b3d-4739-9158-70ce606a6e3e)

  Nó sẽ thực thi luồng tại địa chỉ mà nó truyền vào đó cụ thể ở đây là func thứ 2 của dll đó . 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/6bc6f0ea-d483-4197-9329-e8461b47adf4)

  Load dll đó và IDA . Chúng ta có thể thấy hàm ở vị trí thứ 2 kia . Hàm SfcTerminateWatcherThread kia có khả năng cho phép sửa đổi các tệp hệ thống 
  
## 5. What malware is dropped by the main executable?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/da69514c-691c-4193-bf00-6661d2e2e2c5)

  Về cơ bản nó tạo ra 1 file exe sau đó nó sẽ movefile đến tập file winup.exe . Về cơ bản nó là núp trú dưới 1 file 
  
## 6. What is the purpose of this and the dropped malware? 
  
Đầu tiên, nó tìm kiếm PID của winlogon.exe, sau đó thực hiện bằng cách sử dụng SeDebugPrivilege và tạo một remote winlogon.exe với value  2 của sfc_os.dll  Điều này được thực hiện để tắt
  
  WFP. Sau khi WFP bị tắt, phần mềm độc hại sẽ sao chép tệp C:\Windows\System32\wupdmgr.exe dưới dạng winup.exe. Sau đó, nó thay thế C:\Windows\System32\wupdmgr.exe bằng tệp thực thi được
  
  Lab12-04.exe. Phần mềm độc hại bị loại bỏ này thực thi tệp thực thi Windows Update ban đầu (hiện nằm trong thư mục tạm thời là winup.exe) và cố tải xuống một tệp từ 
  
  http://www.practicalmalwareanalysis.com/updater.exe tới C:\Windows\System32\wupdmgr .exe.
  
# Lab 13-1

## 1. Compare the strings in the malware (from the output of the strings command) with the information available via dynamic analysis. Based on this comparison, which elements might be encoded?
  
  Đường dẫn url đã bị encode . Quan sát trong wirehark chúng ta có thể thấy những cái như http://%s/%s/ , http://www.practicalmalwareanalysis.com/Ym9iYnkteHAzMg==
  
## 2. Use IDA Pro to look for potential encoding by searching for the string xor. What type of encoding do you find?
  
  Nó là loại encoding xor thôi . 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/76766f96-5894-41b9-b9b2-be6bf0a3616e)

  Chúng ta có thấy giá trị key mà nó xor là 0x3B . Sau khi dùng cyber chef để giải mã chúng ta sẽ nhận được chuỗi http://www.practicalmalwareanalysis.com
  
## 3. What is the key used for encoding and what content does it encode?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/31247463-2ab2-4ec1-9b5d-a992d21b8cdb)

  đáp án giống câu 2 
  
## 4. Use the static tools FindCrypt2, Krypto ANALyzer (KANAL), and the IDA Entropy Plugin to identify any other encoding mechanisms. What do you find?
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/c4dba2e2-a8c6-4264-8eeb-e4c76076e7f4)
 Nhìn hình ta thấy tỷ lệ entropy khá cho cho thấy nó đã bị mã hóa . 
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/4e7528db-b0b5-4ec8-96ba-132a3bd0bcc9)

  Chúng ta có thể thấy dấu hiện đặc trưng dễ nhận diện là chuỗi mã hóa của base64
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/f1e354ec-5519-44a9-a576-391fb2d9ca29)

  Khi chúng ta sử dụng plugins yara chúng ta cũng có thể thấy nó nhận đc base64
  
## 5. What type of encoding is used for a portion of the network traffic sent by the malware?
  
  Nó sẽ sử dụng mã hóa base64 mã hóa datta . http://www.practicalmalwareanalysis.com/Ym9iYnkteHAzMg== chuỗi này được gửi đi mỗi 30s . Khi chạy chúng ta có thể thấy nó truyền tới hostname 
  
  bobby-xp32
  
## 6. Where is the Base64 function in the disassembly?\
  
  ![image](https://github.com/YeuPIPI/Practice_Malware_Analyst/assets/72372550/44384772-8df9-4e8b-9ea1-14adeae36c24)

  Nó ở sub_4013B1
  
## 7. What is the maximum length of the Base64-encoded data that is sent? What is encoded?
  
  Nó là 16byte . 12 byte hostname mã hóa base64 thành 16 byte
  
## 8. In this malware, would you ever see the padding characters (= or ==) in the Base64-encoded data? 
  Có. nếu hostname nhỏ hơn 12 byte hoặc k phải bội số của 3
  
## 9. What does this malware do?
  
  Về cơ bản nó cứ gửi request 31s 1 lần cho đến khi byte nó đọc được là 0x6F thì nó sẽ stop
  
# Lab 13-2

## 1. Using dynamic analysis, determine what this malware creates.
  
## 2. Use static techniques such as an xor search, FindCrypt2, KANAL, and the IDA Entropy Plugin to look for potential encoding. What do you find?
  
## 3. Based on your answer to question 1, which imported function would be a good prospect for finding the encoding functions?
  
## 4. Where is the encoding function in the disassembly?
  
## 5. Trace from the encoding function to the source of the encoded content. What is the content?
  
## 6. Can you find the algorithm used for encoding? If not, how can you decode the content?
  
## 7. Using instrumentation, can you recover the original source of one of the encoded files?
  
# Lab 13-3

## 1. Compare the output of strings with the information available via dynamic analysis. Based on this comparison, which elements might be encoded?
  
## 2. Use static analysis to look for potential encoding by searching for the string xor. What type of encoding do you find?
  
## 3. Use static tools like FindCrypt2, KANAL, and the IDA Entropy Plugin to identify any other encoding mechanisms. How do these findings compare with the XOR findings?
  
## 4. Which two encoding techniques are used in this malware?
  
## 5. For each encoding technique, what is the key?
  
## 6. For the cryptographic encryption algorithm, is the key sufficient? What else must be known?
  
## 7. What does this malware do?
  
## 8. Create code to decrypt some of the content produced during dynamic analysis. What is this content?


