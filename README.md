# Practice_Malware_Analyst
# Lab 1-1 This lab uses the files Lab01-01.exe and Lab01-01.dll. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below

# 1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?

có

MD5: 290934c61de9176ad682ffdd65f0a669

SHA256: f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba

File name: Lab01-01.dll

MD5: bb7425b82141a1c0f7d60e5106676bb1


SHA256: 58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47

File name: Mal01-01.exe

# 2. When were these files compiled?

Mal01-01.exe : 2010-12-19 16:16:19 UTC

Lab01-01.dll : 2010-12-19 16:16:38 UTC

# 3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?

những files này không bị pack hay obfuscated

# 4. Do any imports hint at what this malware does? If so, which imports are they?

![image](https://user-images.githubusercontent.com/72372550/220406995-478130fc-8b82-4d5c-b1ca-96c204afc3b0.png)

![image](https://user-images.githubusercontent.com/72372550/220407286-20dcfcea-3210-42cf-888d-988fc3d46e1d.png)



# 5. Are there any other files or host-based indicators that you could look for on infected systems?

Lab01-01.dll strings:

000000026018   000010026018      0   sleep

000000026020   000010026020      0   hello

000000026028   000010026028      0   127.26.152.13

000000026038   000010026038      0   SADFHUHF

Lab01-01.exe strings:

000000003010   000000403010      0   kerne132.dll

000000003020   000000403020      0   kernel32.dll

00000000304C   00000040304C      0   C:\windows\system32\kerne132.dll

000000003070   000000403070      0   Kernel32.

00000000307C   00000040307C      0   Lab01-01.dll

00000000308C   00000040308C      0   C:\Windows\System32\Kernel32.dll

000000003010   000000403010      0   kerne132.dll

000000003020   000000403020      0   kernel32.dll

0000000030B0   0000004030B0      0   WARNING_THIS_WILL_DESTROY_YOUR_MACHINE

# 6. What network-based indicators could be used to find this malware on infected machines?

127.26.152.13

# 7. What would you guess is the purpose of these files?

Nó sẽ tìm kiếm và sao chép các tệp sử dụng dll kết nối tới mạng backdoor tới miền ip 127.26.152.13 . Khi đó kẻ tấn công có thể sử dụng các command như hello , sleep và exec trên hệ thống bị nhiễm như lệnh ngủ và các lệnh hệ thống

# Lab 1-2

Analyze the file Lab01-02.exe
Questions

# 1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

có

MD5	8363436878404da0ae3e46991e355b83

SHA-1	5a016facbcb77e2009a01ea5c67b39af209c3fcb

SHA-256	c876a332d7dd8da331cb8eee7ab7bf32752834d4b2b54eaa362674a2a48f64a6


# 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

DetectItEasy	PE32   Packer: UPX (3.04) [NRV,best]   Compiler: Microsoft Visual C/C++ (6.0)   Linker: Microsoft Linker (6.0) [Console32,console]

Sections
Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5	                              Chi2

UPX0	4096	           16384	      0	        0	      d41d8cd98f00b204e9800998ecf8427e	-1

UPX1	20480	           4096	        1536	    7.07	  ad0f236c2b34f1031486c8cc4803a908	5848.3

UPX2	24576	           4096	        512	      2.8	    f998d25f473e69cc89bf43af3102beea	53922

Chỉ số entropy khá cao cho thấy dấu hiệu rằng file đã bị pack ví dụ như UPX1 có chỉ số entropy là 7.07

Cách 1 : dùng tool https://upx.github.io/ 
để unpack file để có thể chạy ta dùng command sau : ./upx -d Lab01-02.exe -o Lab01-02_unpack.exe và ta sẽ được 1 file đã được unpack

Cách 2 : Tự unpack file bằng cách tìm OEP

Khi load vào IDA ta sẽ thấy ngay hàm pushad
![image](https://user-images.githubusercontent.com/72372550/220503828-400c0392-4600-4ad9-8e3c-56559eb87e99.png)
Đầu tiên nó sẽ lưu hết giá trị của các thanh ghi bằng lệnh pusha

Tiếp theo nó sẽ unpack hết các seations trong bộ nhớ

Nó sẽ fix lại IAT

Dùng lênh popad để khôi phục lại trạng thái của các thanh ghi

Và cuối cùng nhảy đến OEP để thực thi file như ban đầu
![image](https://user-images.githubusercontent.com/72372550/220504505-33afbe2d-111f-4d77-a5aa-c8a1c93b04c5.png)

Nhìn hình chúng ta có thể thấy lệnh popad và lệnh jmp near ptr dword_401190 vậy nên OEP chính là offset 0x401190

Chúng ta đã tìm được OEP h chúng ta sẽ fix lại IAT bằng tool Scylla . Đặt breakpoint tại điểm này để nhảy tới OEP

![image](https://user-images.githubusercontent.com/72372550/220506085-9733e7c2-53e8-4b2e-985d-2bce68902e53.png)

Đây là entrypoint của file gốc và khi đó chúng ta dùng Scylla để fix lại IAT

![image](https://user-images.githubusercontent.com/72372550/220506189-19377b1e-729c-451b-9bfc-09e8a2c7f662.png)

![image](https://user-images.githubusercontent.com/72372550/220506404-5ddfa7fd-ccc2-4bfe-9a5e-7a19f1ea6ce6.png)

Sau khi fix xong và dump bộ nhớ ra chúng ta cũng sẽ được 1 file đã unpack 

![image](https://user-images.githubusercontent.com/72372550/220506597-ff887cee-9399-45c7-bcb7-08f2dec4cd31.png)

# 3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

![image](https://user-images.githubusercontent.com/72372550/220519650-e707044b-5f33-46bd-9746-07efb5fb3f8e.png)
KERNEL32.DLL

SystemTimeToFileTime

GetModuleFileNameA

CreateMutexA

CreateThread

SetWaitableTimer

ADVAPI32.DLL

CreateServiceA

StartServiceCtrlDispatcherA

OpenSCManagerA

WININET.DLL

InternetOpenUrlA

InternetOpenA

# 4. What host- or network-based indicators could be used to identify this malware on infected machines?

Dịch vụ Malservice được cung cấp đến miền URL http://www.malwareanalysisbook.com

# Lab 1-3 Analyze the file Lab01-03.exe. Questions

# 1. Upload the Lab01-03.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

MD5	9c5c27494c28ed0b14853b346b113145

SHA-1	290ab6f431f46547db2628c494ce615d6061ceb8

SHA-256	7983a582939924c70e3da2da80fd3352ebc90de7b8c4c427d484ff4f050f0aec


# 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Ta thấy nó đã bị pack FSG

DetectItEasy	PE32   Packer: FSG (1.0)

File size	4.64 KB (4752 bytes)

PEiD packer	FSG v1.00 (Eng) -> dulek/xt


Ta sẽ dùng tool OllyDBG để tìm OEP
![image](https://user-images.githubusercontent.com/72372550/221394751-fed07134-4183-416e-aa03-0c09e63e4fde.png)

Ta sẽ dùng chức năng trace từng bytewase( very slow) 

![image](https://user-images.githubusercontent.com/72372550/221394780-cb7d7253-282b-4614-8938-24efb704a64f.png)

Sau đó load lại file và bật chức năng stop at entry of self-extrator 

![image](https://user-images.githubusercontent.com/72372550/221394826-db47968f-0776-4737-9d06-8eea2fdf1b93.png)

Khi đó nó sẽ nhảy đến địa chỉ 0x00401090 như hình dưới vậy OEP chính là offset 0x004001090

![image](https://user-images.githubusercontent.com/72372550/221394883-9127596f-05d6-4b2d-bf27-6bab90093f78.png)

Sau khi tìm được OEP ta sẽ tiến hành dump file và fix lại IAT . Ta sẽ đặt breakpoint tại điểm nhảy tới OEP 

![image](https://user-images.githubusercontent.com/72372550/221394950-36153975-8cbe-493b-a3e7-64c17e59818a.png)

![image](https://user-images.githubusercontent.com/72372550/221395031-79854007-75ed-4cde-b9d8-33b380ded191.png)

![image](https://user-images.githubusercontent.com/72372550/221395130-20fa80f6-3852-49f9-8e20-36ee7be98546.png)

Ta sẽ được 1 file đã unpack . Ta thấy sau khi unpack delect it easy đã nhận được được trình biên dịch 

![image](https://user-images.githubusercontent.com/72372550/221395182-433ca1db-d78d-45fe-b4e0-5c99d8ee720d.png)

# 3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

![image](https://user-images.githubusercontent.com/72372550/221395456-a4179ae0-ad2a-4151-9f3c-e7cfb3b71e5e.png)

![image](https://user-images.githubusercontent.com/72372550/221395500-4af0de23-ad1b-49af-9aa0-b7b816197d80.png)

Chúng ta có thể thấy nó có dll OLEAUT32.DLL dùng băm header

# 4. What host- or network-based indicators could be used to identify this malware on infected machines?

http://www.malwareanalysisbook.com/ad.html

ở trong string hiển thị 1 miền URL có khả năng nó kết nối tới miền dịch vụ này

# Lab 1-4 Analyze the file Lab01-04.exe. Questions

# 1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

59 security vendors and 1 sandbox flagged this file as malicious

MD5	625ac05fd47adc3c63700c3b30de79ab

SHA-1	9369d80106dd245938996e245340a3c6f17587fe

SHA-256	0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126

# 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
DetectItEasy	PE32   Compiler: EP:Microsoft Visual C/C++ (6.0 (1720-9782)) [EXE32]   Compiler: Microsoft Visual C/C++ (6.0) [msvcrt]   Linker: Microsoft Linker (6.0*)[GUI32]

File size	36.00 KB (36864 bytes)

PEiD packer	Microsoft Visual C++

Cyren packer	rsrc
![image](https://user-images.githubusercontent.com/72372550/220807331-92b295fa-39f5-4034-8191-42e4b0a8964e.png)

# 3. When was this program compiled?

![image](https://user-images.githubusercontent.com/72372550/220807366-e4b3b773-92e7-4e3f-b18e-3907aad56097.png)

# 4. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
![image](https://user-images.githubusercontent.com/72372550/220807609-41f2cc04-cce3-423c-abb1-adc76b77ce1c.png)

# 5. What host- or network-based indicators could be used to identify this malware on infected machines?
![image](https://user-images.githubusercontent.com/72372550/220807914-b3ba7b8d-3a3c-441f-9607-151ad3f3478b.png)

# 6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?
nó dùng 1 thư viện dll để dowload file
![image](https://user-images.githubusercontent.com/72372550/220809326-179826ef-5bdf-4e6f-8df2-21cd34ecad2c.png)

# Lab 3-1 Analyze the malware found in the file Lab03-01.exe using basic dynamic analysis tools.
# Questions

# 1. What are this malware’s imports and strings? 

Nó import api ExitProcess từ kernel32

![image](https://user-images.githubusercontent.com/72372550/221392012-a16f48ce-e83a-4023-be81-698da3cb5576.png)

![image](https://user-images.githubusercontent.com/72372550/221392015-c0186014-69d4-44a8-af30-667a5c7be538.png)

Có vẻ như nó sẽ kết nối đến 1 URL và thay đổi giá trị của 1 số khóa , ngoài ta còn có vmx32to64.exe là tên phần mềm độc hại

# 2. What are the malware’s host-based indicators?

WinVMX32, vmx32-to64.exe trong C:\WINDOWS\system32 , VideoDriver 

# 3. Are there any useful network-based signatures for this malware? If so, what are they

Chúng ta có thể tháy nó kết nối đến 1 miền www.practicalmalwareanalysis.com

# Lab 3-2 Analyze the malware found in the file Lab03-02.dll using basic dynamic analysis tools.

# 1. How can you get this malware to install itself?

# 2. How would you get this malware to run after installation?

# 3. How can you find the process under which this malware is running?

# 4. Which filters could you set in order to use procmon to glean information?

# 5. What are the malware’s host-based indicators?

# 6. Are there any useful network-based signatures for this malware?

# Lab 3-3Execute the malware found in the file Lab03-03.exe while monitoring it using basic dynamic analysis tools in a safe environment.

# 1. What do you notice when monitoring this malware with Process Explorer?

Khi chạy phần mềm và quan sát dưới process explorer chúng ta sẽ thấy có thêm 1 tiến trình svchost trước khi nó biến mất . Đó có thể là kỹ thuật process hollowing là 1 

kỹ thuật dùng tiến trình làm vỏ bọc của 1 tiến trình nguy hiểm 

# 2. Can you identify any live memory modifications?

![image](https://user-images.githubusercontent.com/72372550/221621194-2c9c0938-4122-471d-b49a-f323bd672eb2.png)

SetWindowsHookExA, practicalmalwareanalysis.log, và [CAPS LOCK] chúng ta có thể nhìn thấy các string trong tiến hình nên có khả năng đây là 1 keylogger

# 3. What are the malware’s host-based indicators?

Chúng ta có thể thấy nó sinh ra 1 file practicalmalwareanalysis.log và khi mở file thì thấy ghi lại các phím đã được nhập

Phân tích nhanh qua phân tích động thì về cơ bản nó chỉ lưu lại ký tự chứ không mở kết nối tới miền nào . Lướt qua thử phân tích tĩnh thì chúng ta thu thập các thông 

tin sau . Trong hàm main nó có 3 hàm chính 

![image](https://user-images.githubusercontent.com/72372550/221623642-7e403b48-1ab4-40ce-908b-6d534187d931.png)

Hàm đầu tiên sẽ là lấy thông tin về hệ thống 

![image](https://user-images.githubusercontent.com/72372550/221624065-0d3dbc29-ef44-4450-a25b-dc54da536d5b.png)

Hàm thứ 2 thì chúng ta có thể thấy nó dùng các api cung cấp tài nguyên 

![image](https://user-images.githubusercontent.com/72372550/221625583-d8c5223b-663d-4e7b-9712-5ff2239db72a.png)

Và hàm cuối cùng là chính sẽ có nhiệm vụ chính là ghi lại ký tự các lưu vào file 

![image](https://user-images.githubusercontent.com/72372550/221626713-c18c7fd3-349c-4eb4-8717-8f002e9e9f81.png)


# 4. What is the purpose of this program?

Đây là 1 mã độc keylogger và nó sẽ lưu hết các ký tự đã nhập vào 1 file . Phân tích động k thấy có kết nối mạng

# Lab 3-4 Analyze the malware found in the file Lab03-04.exe using basic dynamic analysis tools. (This program is analyzed further in the Chapter 9 labs.)

# 1. What happens when you run this file?

Khi chúng ta chạy file sau vài giây nó sẽ tự động xóa process chính nó

# 2. What is causing the roadblock in dynamic analysis? 

Vì ở đây giới hạn là phân tích động không phân tích tĩnh nên chúng ta k biết gì nhiều . Có thể là do có chức năng phát hiện trong sandbox , máy ảo hoặc cũng có thể nó 

chỉ chạy trong 1 số múi giò nhất định

# 3. Are there other ways to run this program?

Dùng 1 số parameter hoặc là debug nó

